# PDFテキスト抽出ツールのログ問題解決報告

## 問題の概要

PDFからテキストを抽出するスクリプトでログメッセージが表示されない問題がありました：
- `extract.py`の先頭に追加したprint文が表示されない
- doc_id抽出のログが表示されない
- 代わりにpdfplumberの低レベルデバッグログだけが大量に表示される

## 原因

デバッグ解析の結果、以下の2つの主要な問題が確認されました：

1. **pdfplumberモジュールのロガーレベル設定問題**:
   - `pdfplumber`のロガーが独自のレベル設定を持たず、デフォルトでルートロガーのレベル(`DEBUG`)を継承
   - その結果、内部デバッグログが大量に出力され、重要なメッセージが埋もれていた

2. **標準出力の扱い**:
   - ロギングハンドラが明示的に設定されておらず、デフォルト設定に依存していた
   - バッファリングによる出力タイミングの問題があった可能性

## 修正内容

以下の修正を実施したことで問題を解決しました：

1. **ロギング設定の改善**:
   ```python
   logging.basicConfig(
       level=logging.DEBUG,
       format='%(asctime)s - %(levelname)s - %(message)s',
       handlers=[
           logging.StreamHandler(sys.stdout)  # 明示的に標準出力に設定
       ]
   )
   
   # pdfplumberのロガーレベルを調整（多くのデバッグメッセージを抑制）
   pdfplumber_logger = logging.getLogger("pdfplumber")
   pdfplumber_logger.setLevel(logging.WARNING)  # WARNINGレベル以上のみ表示
   ```

2. **標準出力のフラッシュ処理追加**:
   - 重要なログポイントごとに`sys.stdout.flush()`を追加し、確実にメッセージが表示されるようにした
   - 特に重要な箇所（スクリプト開始、引数処理後、doc_id抽出時など）に確認用print文を追加

## 検証結果

修正後の動作確認を行った結果：
- スクリプト開始時、メイン関数実行時、ドキュメントID抽出時のログが正しく表示された
- pdfplumberの低レベルデバッグメッセージは大幅に減少
- 通常モードと特許モード両方で正常に動作することを確認

## 今後の課題とベストプラクティス

1. **モジュール単位のロガー設定**:
   - 各モジュール（抽出処理、DB処理など）ごとにロガーを作成し、適切なレベル設定をすることで更に見やすくなる

2. **ログ設定の一元管理**:
   - `config.py`にロギング設定を移動し、プロジェクト全体で統一したログ管理を行う

3. **依存ライブラリのロガー設定の明示化**:
   - 利用する外部ライブラリのロガーレベルを明示的に設定する習慣をつける 